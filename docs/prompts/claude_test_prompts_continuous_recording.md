# Claude Test Prompts - 継続MIDI記録機能

Version: 1.0  
Date: 2025-08-28  
Status: Production Ready  

継続MIDI記録機能の基本操作から応用まで、MCPクライアントでの操作例とテストケース。

## 基本操作フロー

### 1. シンプルな記録・手動終了

```
MIDIキーボードから演奏を記録したいです。30秒待ちで、10秒無音で自動終了、最大5分の設定で記録を開始してください。
```

```
記録中の状態を確認してください。イベント数や進行時間を教えてください。
```

```
演奏が終わったので記録を停止して「piano-practice.mid」として保存してください。
```

### 2. 自動終了（タイムアウト）の確認

```
短時間のテスト用に、初回入力待ち2秒、無音検出3秒、最大30秒の設定で記録を開始してください。そのまま何も入力せずに状態監視してください。
```

```
少し演奏してから止めて、無音タイムアウトでの自動終了を確認してください。
```

### 3. マルチセッション管理

```
3つの記録セッションを同時に開始してください：
1. ドラム用（チャンネル10のみ）
2. ベース用（チャンネル2のみ） 
3. ピアノ用（チャンネル1のみ）

それぞれ異なるタイムアウト設定で。
```

```
現在のアクティブセッション一覧を確認してください。
```

```
4番目のセッションを開始してみてください。制限エラーが出るはずです。
```

### 4. フィルタリング機能

```
ノートとコントロールチェンジのみを記録し、ピッチベンドとプログラムチェンジは除外する設定で記録を開始してください。チャンネルは1、2、10番のみに限定してください。
```

```
記録中にチャンネル3で演奏して、フィルタリングされることを確認してください。
```

## 応用操作

### 5. レッスン記録・再生統合

```
楽器のレッスンを記録して、終了後すぐに再生確認したいです。「lesson-2025-08-28.mid」として記録・保存し、保存後にdryRunで解析してから実際に再生してください。
```

### 6. 長時間記録・メモリ管理

```
イベント数の上限テスト用に、大量のMIDIイベントが発生する設定で記録を開始してください。イベント数が90,000を超えたら状態を確認して、上限に近づいていることを警告してください。
```

### 7. エラーハンドリング・復旧

```
存在しないrecordingIdで状態確認を試してください。エラーレスポンスを確認後、正しいIDで再度実行してください。
```

```
MIDIデバイスが接続されていない状態での記録開始エラーを再現してください。
```

## 監視・デバッグ

### 8. 詳細状態監視

```
記録中のセッションについて、以下を定期的に監視してください：
- 経過時間とタイムアウトまでの残り時間
- チャンネル別活動量
- イベントタイプ別分布
- 推定ファイルサイズ
```

### 9. セッション履歴管理

```
完了済みを含む全セッションの履歴を確認してください。セッション数が多い場合は制限を設けて表示してください。
```

### 10. クリーンアップ・リソース管理

```
現在のメモリ使用量を推定し、不要なセッションがあれば手動で終了してリソースを解放してください。
```

## エラーケース・境界値テスト

### 11. パラメータ検証

```
無効なパラメータ（ppq=50、maxDurationMs=1000など範囲外値）で記録開始を試し、適切な検証エラーが出ることを確認してください。
```

### 12. 同時セッション制限

```
既に3つのアクティブセッションがある状態で4番目を開始し、制限エラーメッセージを確認してください。その後、1つを終了して再度4番目の開始が成功することを確認してください。
```

### 13. ファイル名重複処理

```
同じ名前「test-recording.mid」で連続して2回記録・保存し、重複回避で自動的に番号が付与されることを確認してください。overwrite=trueでの上書き動作も確認してください。
```

## 統合テスト

### 14. エンドツーエンドフロー

```
以下の完全なワークフローを実行してください：
1. 継続記録でピアノ演奏をキャプチャ
2. SMFファイルとして保存
3. smf_to_jsonでJSON化
4. JSONを確認・編集（テンポやダイナミクスの調整）
5. json_to_smfで再コンパイル
6. play_smfで再生確認
```

### 15. 複数形式での保存・変換

```
継続記録で保存したSMFを、以下の形式で出力してください：
1. 元のSMF（data/midi/）
2. JSON MIDI形式（smf_to_json）
3. エクスポート（data/export/）
4. 必要に応じてScore DSL形式への変換例
```

## パフォーマンス・負荷テスト

### 16. 高頻度イベント処理

```
短時間（30秒）で高頻度のMIDIイベント（CC値の連続変化など）を記録し、システムの応答性とメモリ使用量を監視してください。
```

### 17. 長時間記録テスト

```
最大記録時間（5分）での長時間記録を実行し、メモリリークやパフォーマンス劣化がないことを確認してください。
```

## 注意事項・制約

- テスト実行時はMIDI入力デバイス（IAC Driver等）の準備を確認
- 大量データテスト時はディスク容量に注意  
- マルチセッション時は各セッションのポート競合回避
- 長時間テスト時は他のMCPツール動作への影響を考慮

## トラブルシューティング

**よくある問題**:
- 「DEVICE_UNAVAILABLE」→ list_input_devicesでポート確認
- 「Maximum concurrent sessions exceeded」→ list_continuous_recordingsでアクティブ数確認
- タイムアウトしない→ パラメータの最小値制約を確認  
- メモリ使用量異常→ イベント数100K制限・10MB制限の動作確認

**デバッグ手順**:
1. list_input_devices でMIDI環境確認
2. list_continuous_recordings でセッション状況確認  
3. get_continuous_recording_status で詳細状態確認
4. 必要に応じて stop_continuous_recording で強制終了