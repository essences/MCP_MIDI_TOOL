# 次の一手・確認用プロンプト（Claude Desktop 用）

以下をそのまま貼り付けて使用してください。MCP MIDI TOOL と接続済みを前提に、受信側が鳴るかを短手順で検証し、結果に基づいて次アクションを決定します。

---

あなたはMCP MIDI TOOLプロジェクトの「次の一手」を確定する相棒です。次の手順で現状を確認し、推奨アクションを1つに絞って提示してください。

1) 初期確認
- tools/list, prompts/list を読み取り可能なら省略可。以後の実行に支障がなければ続行。

2) 受信側の即時検証
- まず list_devices を実行して、利用可能なMIDI出力ポート一覧を表示してください。
- 見つかったら、`IAC`, `Network`, `Virtual` を優先。ユーザーの希望があればそのポートを優先。
- 見つからない、または擬似名のみの場合は、次を提示：
  - docs/setup/macos_coremidi_receiver.md を開いて IAC をオンライン化/ポート作成
  - DAW側で IAC 入力を有効化
  - 再度 list_devices を実行

3) 発音スモークテスト
- devices の中から IAC 由来など安全なポートを1つ選び、playback_midi を1回だけ実行：
  - 例: { durationMs: 800, portName: "IAC" }（部分一致可。具体名が分かればそれを優先）
- 実行結果を表示し、ユーザーに「音が鳴ったか」を是非で確認。

4) 次の一手の決定（分岐）
- 鳴った → 次の優先候補から1つに絞って提案：
  - SMF再生スケジューラのTDD着手（テンポ/デルタタイムに基づくノートスケジューリング）
  - ログ/エラーモデル共通化（構造化ログとエラーコード）
  - メタ情報抽出の拡充（durationMs/ppq 等）
- 鳴らない → 是正アクションを1つに絞って提案：
  - 受信側（IAC/DAW）の再設定（手順書へのディープリンク付き）
  - portName の明示指定（list_devices の実名から再試行）
  - durationMs を 800→1200ms に延長して再試行

5) 出力フォーマット（厳守）
- 現状: 箇条書き（devicesの有無/選択ポート/再生結果）
- ブロッカー: あれば1行で
- 推奨する次の一手: 1文で明確に
- 実行チェックリスト: 3–5項目
- ロールバック/代替: 1–2項目

補足:
- list_devices や playback_midi の結果は、そのまま本文にも転記してください（ツール出力がクライアントに表示されない場合への備え）。
- `durationMs` は 800–1500ms が聴感上わかりやすいです。
- portName は完全一致不要、部分一致で最も近い候補を選びます。

参照: docs/setup/macos_coremidi_receiver.md / docs/checklists/receiver_setup_checklist.md / BACKLOG.md
